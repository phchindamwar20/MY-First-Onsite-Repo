<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email_to_BD_s</name>
        <label>Send Email to BD&apos;s</label>
        <locationX>176</locationX>
        <locationY>431</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>forT_EmailReceipents</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>textT_EmailSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>textT_EmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>relatedRecordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>logEmailOnSend</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <environments>Default</environments>
    <formulas>
        <name>forT_EmailReceipents</name>
        <dataType>String</dataType>
        <expression>IF(
ISBLANK({!$Record.BD_Account_Manager__c}),&quot;&quot;,
{!$Record.BD_Account_Manager__r.Email} &amp; &quot;,&quot;)
&amp;
IF(
ISBLANK({!$Record.BD_Account_Manager_2__c}),&quot;&quot;,
{!$Record.BD_Account_Manager_2__r.Email} &amp; &quot;,&quot;)
&amp;
IF(
ISBLANK({!$Record.BD_Account_Manager_3__c}),&quot;&quot;,
{!$Record.BD_Account_Manager_3__r.Email})</expression>
    </formulas>
    <formulas>
        <name>forT_LinkJob</name>
        <dataType>String</dataType>
        <expression>LEFT($Api.Enterprise_Server_URL_510, FIND( &apos;/services&apos;, $Api.Enterprise_Server_URL_510))&amp;{!$Record.Id}</expression>
    </formulas>
    <formulas>
        <name>forT_PDName</name>
        <dataType>String</dataType>
        <expression>{!$Record.Project_Director__r.FirstName}&amp;&quot; &quot;&amp;{!$Record.Project_Director__r.LastName}</expression>
    </formulas>
    <formulas>
        <name>forT_PMName</name>
        <dataType>String</dataType>
        <expression>{!$Record.Project_Manager__r.FirstName}&amp;&quot; &quot;&amp;{!$Record.Project_Manager__r.LastName}</expression>
    </formulas>
    <formulas>
        <name>forT_RM_CM_OMName</name>
        <dataType>String</dataType>
        <expression>{!$Record.RM_CM_OM__r.FirstName}&amp;&quot; &quot;&amp;{!$Record.RM_CM_OM__r.LastName}</expression>
    </formulas>
    <interviewLabel>Job - After Save U - Job Collected Email Alert {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Job - After Save U - Job Collected Email Alert</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>Set_Job_Collected_Email_Sent</name>
        <label>Set Job Collected Email Sent</label>
        <locationX>176</locationX>
        <locationY>323</locationY>
        <connector>
            <targetReference>Send_Email_to_BD_s</targetReference>
        </connector>
        <inputAssignments>
            <field>Job_Collected_Email_Sent__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_Job_Collected_Email_Sent</targetReference>
        </connector>
        <filterFormula>AND(
  {!$Setup.DataAdmin__c.TurnOffFlow__c} = false,
  {!$Record.Job_Collected_Email_Sent__c} = false,
  {!$Record.Paid_to_Date__c} = {!$Record.ROM_Contracted_Sales__c},
  {!$Record.Paid_to_Date__c}  != 0,
  OR(
    ISCHANGED({!$Record.Paid_to_Date__c} ),
    ISCHANGED({!$Record.ROM_Contracted_Sales__c})
  ),
  OR(
    NOT(ISBLANK({!$Record.BD_Account_Manager__c})), 
    NOT(ISBLANK({!$Record.BD_Account_Manager_2__c})), 
    NOT(ISBLANK({!$Record.BD_Account_Manager_3__c}))
  )
)</filterFormula>
        <object>WorkOrder</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>textT_EmailBody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Job Info&lt;/p&gt;&lt;p&gt;Job &lt;a href=&quot;{!forT_LinkJob}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;{!$Record.WorkOrderNumber}&lt;/a&gt; has been fully collected&lt;/p&gt;&lt;p&gt;Account Name: {!$Record.Account_Name__c}&lt;/p&gt;&lt;p&gt;Project Director: {!forT_PDName}&lt;/p&gt;&lt;p&gt;Project Manager: {!forT_PMName}&lt;/p&gt;&lt;p&gt;RM/CM/OM: {!forT_RM_CM_OMName}&lt;/p&gt;&lt;p&gt;Contracted Sales: {!$Record.ROM_Contracted_Sales__c}&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>textT_EmailSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Job {!$Record.WorkOrderNumber} has been fully collected-{!$Record.Account_Name__c}-{!$Record.City},{!$Record.State}</text>
    </textTemplates>
</Flow>
